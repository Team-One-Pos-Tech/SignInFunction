name: Continuous Deployment

on:
  push:
    branches: [ "main" ]

jobs:

  # deploy:
  #   runs-on: ubuntu-latest
  #   steps:
  #   - uses: actions/checkout@v3

  #   - name: Setup AWS SAM CLI
  #     uses: aws-actions/setup-sam@v2
  #     with:
  #       use-installer: true
  #       token: ${{ secrets.GITHUB_TOKEN }}

  #   - name: Authenticate on AWS
  #     uses: aws-actions/configure-aws-credentials@v2
  #     with:
  #       aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
  #       aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
  #       aws-session-token: ${{ secrets.AWS_SESSION_TOKEN }}
  #       aws-region: us-east-1

  #   - name: Build Function
  #     run: sam build

    create-and-publish-image:
      needs: build-and-test
      permissions: write-all
      runs-on: ubuntu-latest
      steps:     
      - uses: actions/checkout@v4
      - name: Login to GitHub Container Registry
        uses: docker/login-action@v1
        with:
          registry: ghcr.io
          username: '${{github.actor}}'
          password: '${{secrets.GITHUB_TOKEN}}'

      - name: Build Image
        run: docker build -t ghcr.io/team-one-pos-tech/snack-hub.lambda.auth .
      
      - name: Push Image
        run: docker push ghcr.io/team-one-pos-tech/snack-hub.lambda.auth

    # - name: Build Function
    #   run: sam build

    # - name: Deploy Function
    #   run: sam deploy --no-confirm-changeset --no-fail-on-empty-changeset
